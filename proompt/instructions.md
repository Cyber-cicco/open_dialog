I feel like there is an opportunity for a proc macro here.

